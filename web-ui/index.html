<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PG-View Knowledge Graph Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 10px;
            padding: 20px 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #667eea;
            font-size: 28px;
            margin-bottom: 10px;
        }

        .status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .main-grid {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .sidebar {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            height: fit-content;
        }

        .sidebar h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #333;
        }

        .nav-button {
            display: block;
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 8px;
            background: #f3f4f6;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            text-align: left;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            transition: all 0.2s;
        }

        .nav-button:hover {
            background: #e5e7eb;
        }

        .nav-button.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .content {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            min-height: 500px;
        }

        .content h2 {
            color: #333;
            font-size: 24px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            min-height: 120px;
            font-family: 'Courier New', monospace;
            resize: vertical;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-right: 10px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .result-box {
            margin-top: 20px;
            padding: 20px;
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
        }

        .result-box pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #1f2937;
        }

        .success {
            padding: 15px;
            background: #d1fae5;
            border: 2px solid #10b981;
            border-radius: 8px;
            color: #065f46;
            margin-bottom: 20px;
        }

        .error {
            padding: 15px;
            background: #fee2e2;
            border: 2px solid #ef4444;
            border-radius: 8px;
            color: #991b1b;
            margin-bottom: 20px;
        }

        .info {
            padding: 15px;
            background: #dbeafe;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            color: #1e40af;
            margin-bottom: 20px;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .card {
            padding: 20px;
            background: #f9fafb;
            border-radius: 8px;
            border: 2px solid #e5e7eb;
        }

        .card h3 {
            font-size: 16px;
            margin-bottom: 10px;
            color: #374151;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f4f6;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        .table th {
            background: #f3f4f6;
            font-weight: 600;
            color: #374151;
        }

        .quick-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            background: #667eea;
            color: white;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üîÆ PG-View Knowledge Graph Manager</h1>
            <p style="color: #6b7280; margin-bottom: 10px;">Interactive interface for managing property graphs and views</p>
            <div class="status">
                <span class="status-dot"></span>
                <span id="statusText" style="color: #10b981; font-weight: 600;">Connected to API Server</span>
            </div>
        </div>

        <!-- Main Grid -->
        <div class="main-grid">
            <!-- Sidebar Navigation -->
            <div class="sidebar">
                <h2>Navigation</h2>
                <button class="nav-button active" onclick="showSection('connection')">üîå Connection</button>
                <button class="nav-button" onclick="showSection('graphs')">üìä Graphs</button>
                <button class="nav-button" onclick="showSection('schema')">üèóÔ∏è Schema</button>
                <button class="nav-button" onclick="showSection('data')">üìù Data</button>
                <button class="nav-button" onclick="showSection('query')">üîç Query</button>
                <button class="nav-button" onclick="showSection('views')">üëÅÔ∏è Views</button>
                <button class="nav-button" onclick="showSection('explore')">üó∫Ô∏è Explore</button>
            </div>

            <!-- Main Content -->
            <div class="content">
                <!-- Connection Section -->
                <div id="section-connection" class="section">
                    <h2>Connection Settings</h2>
                    <div class="info">
                        <strong>üí° Tip:</strong> Choose your backend platform. PostgreSQL for production, SimpleDatalog for testing.
                    </div>
                    
                    <div class="form-group">
                        <label>Backend Platform</label>
                        <select id="platform">
                            <option value="pg">PostgreSQL (Production)</option>
                            <option value="sd">SimpleDatalog (Testing)</option>
                            <option value="lb">LogicBlox (Advanced)</option>
                            <option value="n4">Neo4j (Graph DB)</option>
                        </select>
                    </div>

                    <button class="btn btn-primary" onclick="connectPlatform()">Connect to Backend</button>
                    <button class="btn btn-secondary" onclick="checkHealth()">Check Server Health</button>

                    <div id="connectionResult" class="result-box hidden"></div>
                </div>

                <!-- Graphs Section -->
                <div id="section-graphs" class="section hidden">
                    <h2>Graph Management</h2>
                    
                    <div class="grid-2">
                        <div class="card">
                            <h3>Create New Graph</h3>
                            <div class="form-group">
                                <label>Graph Name</label>
                                <input type="text" id="newGraphName" placeholder="e.g., MyKnowledgeGraph">
                            </div>
                            <button class="btn btn-success" onclick="createGraph()">Create Graph</button>
                        </div>

                        <div class="card">
                            <h3>Use Existing Graph</h3>
                            <div class="form-group">
                                <label>Graph Name</label>
                                <input type="text" id="useGraphName" placeholder="Enter graph name">
                            </div>
                            <button class="btn btn-primary" onclick="useGraph()">Use Graph</button>
                        </div>
                    </div>

                    <div style="margin-top: 20px;">
                        <button class="btn btn-secondary" onclick="listGraphs()">List All Graphs</button>
                    </div>

                    <div id="graphsResult" class="result-box hidden"></div>
                </div>

                <!-- Schema Section -->
                <div id="section-schema" class="section hidden">
                    <h2>Schema Management</h2>
                    
                    <div class="grid-2">
                        <div class="card">
                            <h3>Add Node Type</h3>
                            <div class="form-group">
                                <label>Node Label</label>
                                <input type="text" id="nodeLabel" placeholder="e.g., Person, Entity, Document">
                            </div>
                            <button class="btn btn-success" onclick="addNodeSchema()">Add Node Type</button>
                        </div>

                        <div class="card">
                            <h3>Add Edge Type</h3>
                            <div class="form-group">
                                <label>Edge Label</label>
                                <input type="text" id="edgeLabel" placeholder="e.g., Knows, RelatesTo">
                            </div>
                            <div class="form-group">
                                <label>From Node Type</label>
                                <input type="text" id="edgeFrom" placeholder="Source node type">
                            </div>
                            <div class="form-group">
                                <label>To Node Type</label>
                                <input type="text" id="edgeTo" placeholder="Target node type">
                            </div>
                            <button class="btn btn-success" onclick="addEdgeSchema()">Add Edge Type</button>
                        </div>
                    </div>

                    <div style="margin-top: 20px;">
                        <button class="btn btn-secondary" onclick="getSchema()">View Current Schema</button>
                    </div>

                    <div id="schemaResult" class="result-box hidden"></div>
                </div>

                <!-- Data Section -->
                <div id="section-data" class="section hidden">
                    <h2>Data Management</h2>
                    
                    <div class="quick-actions">
                        <button class="btn btn-secondary" onclick="showDataForm('node')">Add Node</button>
                        <button class="btn btn-secondary" onclick="showDataForm('edge')">Add Edge</button>
                        <button class="btn btn-secondary" onclick="showDataForm('property')">Add Property</button>
                        <button class="btn btn-secondary" onclick="showDataForm('raw')">Raw Insert</button>
                    </div>

                    <!-- Node Form -->
                    <div id="dataForm-node" class="card hidden">
                        <h3>Insert Node</h3>
                        <div class="form-group">
                            <label>Node ID</label>
                            <input type="number" id="nodeId" placeholder="e.g., 1">
                        </div>
                        <div class="form-group">
                            <label>Node Label</label>
                            <input type="text" id="nodeDataLabel" placeholder="e.g., Person">
                        </div>
                        <button class="btn btn-success" onclick="insertNode()">Insert Node</button>
                    </div>

                    <!-- Edge Form -->
                    <div id="dataForm-edge" class="card hidden">
                        <h3>Insert Edge</h3>
                        <div class="form-group">
                            <label>Edge ID</label>
                            <input type="number" id="edgeId" placeholder="e.g., 10">
                        </div>
                        <div class="form-group">
                            <label>From Node ID</label>
                            <input type="number" id="edgeFromId" placeholder="Source node">
                        </div>
                        <div class="form-group">
                            <label>To Node ID</label>
                            <input type="number" id="edgeToId" placeholder="Target node">
                        </div>
                        <div class="form-group">
                            <label>Edge Label</label>
                            <input type="text" id="edgeDataLabel" placeholder="e.g., Knows">
                        </div>
                        <button class="btn btn-success" onclick="insertEdge()">Insert Edge</button>
                    </div>

                    <!-- Property Form -->
                    <div id="dataForm-property" class="card hidden">
                        <h3>Insert Property</h3>
                        <div class="form-group">
                            <label>Type</label>
                            <select id="propType">
                                <option value="NP">Node Property</option>
                                <option value="EP">Edge Property</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Element ID</label>
                            <input type="number" id="propId" placeholder="Node or Edge ID">
                        </div>
                        <div class="form-group">
                            <label>Property Name</label>
                            <input type="text" id="propName" placeholder="e.g., name, age">
                        </div>
                        <div class="form-group">
                            <label>Property Value</label>
                            <input type="text" id="propValue" placeholder="e.g., Alice, 30">
                        </div>
                        <button class="btn btn-success" onclick="insertProperty()">Insert Property</button>
                    </div>

                    <!-- Raw Insert Form -->
                    <div id="dataForm-raw" class="card hidden">
                        <h3>Raw Insert Command</h3>
                        <div class="form-group">
                            <label>Relation Name</label>
                            <input type="text" id="rawRelName" placeholder="N, E, NP, or EP">
                        </div>
                        <div class="form-group">
                            <label>Arguments</label>
                            <input type="text" id="rawArgs" placeholder='e.g., 1,"Person" or 10,1,2,"Knows"'>
                        </div>
                        <button class="btn btn-success" onclick="insertRaw()">Execute Insert</button>
                    </div>

                    <div id="dataResult" class="result-box hidden"></div>
                </div>

                <!-- Query Section -->
                <div id="section-query" class="section hidden">
                    <h2>Query Graph</h2>
                    
                    <div class="info">
                        <strong>üí° Examples:</strong><br>
                        <code>MATCH (a:Person)-[x:Knows]->(b:Person) FROM g RETURN (a),(b),(x)</code><br>
                        <code>MATCH (e:Entity) FROM g WHERE e.name = "Alice" RETURN (e)</code>
                    </div>

                    <div class="form-group">
                        <label>GQL Query</label>
                        <textarea id="queryText" placeholder="Enter your GQL query here..."></textarea>
                    </div>

                    <div class="quick-actions">
                        <button class="btn btn-primary" onclick="executeQuery()">Execute Query</button>
                        <button class="btn btn-secondary" onclick="loadSampleQuery('basic')">Sample: Basic Match</button>
                        <button class="btn btn-secondary" onclick="loadSampleQuery('properties')">Sample: With Properties</button>
                    </div>

                    <div id="queryResult" class="result-box hidden"></div>
                </div>

                <!-- Views Section -->
                <div id="section-views" class="section hidden">
                    <h2>View Management</h2>
                    
                    <div class="info">
                        <strong>üí° Create Views:</strong> Define derived graphs with transformations, filters, or derived relationships.
                    </div>

                    <div class="form-group">
                        <label>View Definition (GQL)</label>
                        <textarea id="viewDefinition" placeholder='CREATE virtual VIEW MyView ON g (&#10;  MATCH (a:Person)-[x:Knows]->(b:Person)&#10;)'></textarea>
                    </div>

                    <div class="quick-actions">
                        <button class="btn btn-success" onclick="createView()">Create View</button>
                        <button class="btn btn-secondary" onclick="listViews()">List All Views</button>
                        <button class="btn btn-secondary" onclick="loadSampleView('selection')">Sample: Selection View</button>
                        <button class="btn btn-secondary" onclick="loadSampleView('transformation')">Sample: Transformation</button>
                    </div>

                    <div id="viewsResult" class="result-box hidden"></div>
                </div>

                <!-- Explore Section -->
                <div id="section-explore" class="section hidden">
                    <h2>Explore Database</h2>
                    
                    <div class="quick-actions">
                        <button class="btn btn-primary" onclick="exploreSchema()">üìã Show Schema</button>
                        <button class="btn btn-primary" onclick="exploreViews()">üëÅÔ∏è Show Views</button>
                        <button class="btn btn-primary" onclick="exploreProgram()">üîß Show Datalog Program</button>
                        <button class="btn btn-secondary" onclick="quickStats()">üìä Quick Stats</button>
                    </div>

                    <div id="exploreResult" class="result-box hidden"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:7070';
        let currentPlatform = 'lb';
        let currentGraph = null;

        // Show/Hide sections
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(`section-${sectionName}`).classList.remove('hidden');
            
            document.querySelectorAll('.nav-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // API Helper
        async function apiCall(endpoint, method = 'GET', body = null) {
            try {
                const options = {
                    method: method,
                    headers: {'Content-Type': 'application/json'}
                };
                if (body) {
                    options.body = JSON.stringify(body);
                }
                const response = await fetch(`${API_URL}${endpoint}`, options);
                return await response.json();
            } catch (error) {
                return {success: false, error: error.message};
            }
        }

        // Show result
        function showResult(elementId, data, isSuccess = true) {
            const element = document.getElementById(elementId);
            element.classList.remove('hidden');
            
            if (typeof data === 'object') {
                element.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
            } else {
                element.innerHTML = `<pre>${data}</pre>`;
            }
        }

        // Connection functions
        async function checkHealth() {
            const result = await apiCall('/health');
            showResult('connectionResult', result);
        }

        async function connectPlatform() {
            const platform = document.getElementById('platform').value;
            const result = await apiCall('/connect', 'POST', {platform});
            currentPlatform = platform;
            showResult('connectionResult', result);
        }

        // Graph functions
        async function createGraph() {
            const name = document.getElementById('newGraphName').value;
            if (!name) {
                alert('Please enter a graph name');
                return;
            }
            const result = await apiCall('/graph/create', 'POST', {name});
            currentGraph = name;
            showResult('graphsResult', result);
        }

        async function useGraph() {
            const name = document.getElementById('useGraphName').value;
            if (!name) {
                alert('Please enter a graph name');
                return;
            }
            const result = await apiCall('/graph/use', 'POST', {name});
            currentGraph = name;
            showResult('graphsResult', result);
        }

        async function listGraphs() {
            const result = await apiCall('/graphs');
            showResult('graphsResult', result);
        }

        // Schema functions
        async function addNodeSchema() {
            const label = document.getElementById('nodeLabel').value;
            if (!label) {
                alert('Please enter a node label');
                return;
            }
            const result = await apiCall('/schema/node', 'POST', {label});
            showResult('schemaResult', result);
        }

        async function addEdgeSchema() {
            const label = document.getElementById('edgeLabel').value;
            const from = document.getElementById('edgeFrom').value;
            const to = document.getElementById('edgeTo').value;
            if (!label || !from || !to) {
                alert('Please fill all fields');
                return;
            }
            const result = await apiCall('/schema/edge', 'POST', {label, from, to});
            showResult('schemaResult', result);
        }

        async function getSchema() {
            const result = await apiCall('/schema');
            showResult('schemaResult', result);
        }

        // Data functions
        function showDataForm(formType) {
            document.querySelectorAll('[id^="dataForm-"]').forEach(form => {
                form.classList.add('hidden');
            });
            document.getElementById(`dataForm-${formType}`).classList.remove('hidden');
        }

        async function insertNode() {
            const id = document.getElementById('nodeId').value;
            const label = document.getElementById('nodeDataLabel').value;
            if (!id || !label) {
                alert('Please fill all fields');
                return;
            }
            const result = await apiCall('/data/insert', 'POST', {
                relName: 'N',
                args: `${id},"${label}"`
            });
            showResult('dataResult', result);
        }

        async function insertEdge() {
            const id = document.getElementById('edgeId').value;
            const from = document.getElementById('edgeFromId').value;
            const to = document.getElementById('edgeToId').value;
            const label = document.getElementById('edgeDataLabel').value;
            if (!id || !from || !to || !label) {
                alert('Please fill all fields');
                return;
            }
            const result = await apiCall('/data/insert', 'POST', {
                relName: 'E',
                args: `${id},${from},${to},"${label}"`
            });
            showResult('dataResult', result);
        }

        async function insertProperty() {
            const type = document.getElementById('propType').value;
            const id = document.getElementById('propId').value;
            const name = document.getElementById('propName').value;
            const value = document.getElementById('propValue').value;
            if (!id || !name || !value) {
                alert('Please fill all fields');
                return;
            }
            const result = await apiCall('/data/insert', 'POST', {
                relName: type,
                args: `${id},"${name}","${value}"`
            });
            showResult('dataResult', result);
        }

        async function insertRaw() {
            const relName = document.getElementById('rawRelName').value;
            const args = document.getElementById('rawArgs').value;
            if (!relName || !args) {
                alert('Please fill all fields');
                return;
            }
            const result = await apiCall('/data/insert', 'POST', {relName, args});
            showResult('dataResult', result);
        }

        // Query functions
        async function executeQuery() {
            const query = document.getElementById('queryText').value;
            if (!query) {
                alert('Please enter a query');
                return;
            }
            const result = await apiCall('/query', 'POST', {query});
            showResult('queryResult', result);
        }

        function loadSampleQuery(type) {
            const queries = {
                basic: 'MATCH (a:Person)-[x:Knows]->(b:Person) FROM g RETURN (a),(b),(x)',
                properties: 'MATCH (e:Entity) FROM g WHERE e.name = "Alice" RETURN (e)'
            };
            document.getElementById('queryText').value = queries[type];
        }

        // View functions
        async function createView() {
            const definition = document.getElementById('viewDefinition').value;
            if (!definition) {
                alert('Please enter a view definition');
                return;
            }
            const result = await apiCall('/view/create', 'POST', {definition});
            showResult('viewsResult', result);
        }

        async function listViews() {
            const result = await apiCall('/views');
            showResult('viewsResult', result);
        }

        function loadSampleView(type) {
            const views = {
                selection: `CREATE virtual VIEW PersonView ON g (
  MATCH (p:Person)-[k:Knows]->(p2:Person)
)`,
                transformation: `CREATE virtual VIEW UserNetwork ON g WITH DEFAULT MAP (
  MATCH (p:Person)-[k:Knows]->(p2:Person)
  CONSTRUCT (p:User)-[c:ConnectedTo]->(p2:User)
)`
            };
            document.getElementById('viewDefinition').value = views[type];
        }

        // Explore functions
        async function exploreSchema() {
            const result = await apiCall('/schema');
            showResult('exploreResult', result);
        }

        async function exploreViews() {
            const result = await apiCall('/views');
            showResult('exploreResult', result);
        }

        async function exploreProgram() {
            const result = await apiCall('/program');
            showResult('exploreResult', result);
        }

        async function quickStats() {
            const schemaResult = await apiCall('/schema');
            const viewsResult = await apiCall('/views');
            
            const stats = {
                platform: currentPlatform,
                currentGraph: currentGraph || 'None',
                schema: schemaResult,
                views: viewsResult
            };
            
            showResult('exploreResult', stats);
        }

        // Initialize
        checkHealth();
    </script>
</body>
</html>

